<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>資產複利增長詳細計算表 - 終極版</title>
<style>
  :root{--bg:#f0f8ff;--card:rgba(255,255,255,0.94);--text:#0a2d4a;--input:#fff;--accent:#ff6d00;--accent-l:#ff8a3d;}
  body.dark{--bg:#0a1422;--card:rgba(15,25,45,0.95);--text:#e3f2fd;--input:rgba(40,60,100,0.85);--accent:#ff8a3d;--accent-l:#ffb74d;}
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:"Microsoft JhengHei","PingFang HK",sans-serif;background:linear-gradient(135deg,#a7e1f5,var(--bg));color:var(--text);min-height:100vh;padding:20px;transition:.6s;}
  .container{max-width:1100px;margin:auto;background:var(--card);border-radius:32px;padding:45px;box-shadow:0 25px 80px rgba(0,0,0,.18);backdrop-filter:blur(20px);}
  h1{font-size:2.8rem;font-weight:900;background:linear-gradient(90deg,var(--accent),var(--accent-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center;margin-bottom:12px;}
  .subtitle{font-size:1.15rem;opacity:.85;text-align:center;margin-bottom:35px;}
  .controls{display:flex;justify-content:center;gap:16px;flex-wrap:wrap;margin:35px 0;}
  select,.mode-btn{padding:12px 24px;border:none;border-radius:50px;background:var(--input);color:var(--text);font-weight:600;cursor:pointer;box-shadow:0 8px 25px rgba(0,0,0,.1);transition:.3s;}
  select:hover,.mode-btn:hover{transform:translateY(-3px);}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:28px;margin:40px 0;}
  label{font-weight:700;color:var(--accent);margin-bottom:10px;display:block;}
  input{width:100%;height:68px;padding:0 24px;font-size:1.4rem;font-weight:600;border:none;border-radius:20px;background:var(--input);box-shadow:0 10px 30px rgba(0,0,0,.12);}
  input:focus{outline:none;box-shadow:0 0 0 5px rgba(255,109,0,.3);}
  .calc-btn{display:block;margin:50px auto;padding:20px 70px;font-size:1.6rem;font-weight:900;color:#fff;background:linear-gradient(45deg,var(--accent),var(--accent-l));border:none;border-radius:50px;cursor:pointer;box-shadow:0 15px 40px rgba(255,109,0,.5);transition:.4s;}
  .calc-btn:hover{transform:translateY(-6px);box-shadow:0 25px 60px rgba(255,109,0,.6);}
  
  #result{text-align:center;font-size:2.6rem;font-weight:900;margin:40px 0 30px;}
  #finalNum{background:linear-gradient(90deg,var(--accent),var(--accent-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:1.3em;}
  
  table{width:100%;border-collapse:collapse;margin-top:30px;background:var(--input);border-radius:20px;overflow:hidden;box-shadow:0 15px 40px rgba(0,0,0,.15);}
  th{background:linear-gradient(90deg,var(--accent),var(--accent-l));color:white;padding:18px;font-size:1.1rem;}
  td{padding:14px 12px;text-align:right;font-weight:500;}
  tr:nth-child(even){background:rgba(0,0,0,.03);}
  body.dark tr:nth-child(even){background:rgba(255,255,255,.05);}
  .highlight td{font-weight:900;font-size:1.1em;background:rgba(255,109,0,.15)!important;}
  @media(max-width:768px){
    h1{font-size:2.2rem;} #result{font-size:2rem;}
    table{font-size:0.9rem;} th,td{padding:10px 6px;}
  }
</style>
</head>
<body>

<div class="container">
  <h1>資產複利增長詳細計算表</h1>
  <p class="subtitle">清楚看見每一筆投入與收益如何滾出財富雪球</p>

  <div class="controls">
    <select id="currency"><option value="HKD">HK$ 港幣</option><option value="USD">USD 美金</option></select>
    <select id="timeUnit"><option value="year">年</option><option value="month">個月</option><option value="week">週</option></select>
    <button class="mode-btn" id="darkBtn">暗黑模式</button>
  </div>

  <div class="grid">
    <div><label>當前資產</label><input type="number" id="initial" min="0" value="500000"></div>
    <div><label>預期年回報率 (%)</label><input type="number" id="rate" step="0.1" value="8"></div>
    <div><label>預測時間數量</label><input type="number" id="timeValue" min="1" value="20"></div>
    <div><label>每期定投金額</label><input type="number" id="periodicAdd" min="0" value="10000"></div>
  </div>

  <button class="calc-btn">立即計算詳細報表</button>
  
  <div id="result">點擊上方按鈕開始計算</div>
  
  <table id="table" style="display:none;">
    <thead>
      <tr>
        <th>期數</th>
        <th>時間</th>
        <th>期初金額</th>
        <th>本期投入</th>
        <th>本期收益</th>
        <th>期末金額</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>
</div>

<script>
const C = {HKD:{s:'HK$',r:1}, USD:{s:'US$',r:7.8}};
const $ = id=>document.getElementById(id);

function fmt(n){
  const cur = $('currency').value;
  const val = cur==='USD' ? Math.round(n/7.8) : Math.round(n);
  return C[cur].s + val.toLocaleString('en-HK');
}
function unitText(){return {year:'年',month:'個月',week:'週'}[$('timeUnit').value];}

function save(){
  localStorage.setItem('w', JSON.stringify({
    initial:$('initial').value, rate:$('rate').value, timeValue:$('timeValue').value,
    periodicAdd:$('periodicAdd').value, currency:$('currency').value, timeUnit:$('timeUnit').value,
    dark:document.body.classList.contains('dark')
  }));
}
function load(){
  const d = JSON.parse(localStorage.getItem('w')||'null');
  if(d){
    $('initial').value = d.initial??500000;
    $('rate').value = d.rate??8;
    $('timeValue').value = d.timeValue??20;
    $('periodicAdd').value = d.periodicAdd??10000;
    $('currency').value = d.currency??'HKD';
    $('timeUnit').value = d.timeUnit??'year';
    if(d.dark) document.body.classList.add('dark');
  }
}

function calc(){
  save();

  const initial = Math.max(0, +$('initial').value||0);
  const annualRate = (+$('rate').value||0)/100;
  const timeValue = Math.max(Math.max(1, +$('timeValue').value||1));
  const add = Math.max(0, +$('periodicAdd').value||0);
  const unit = $('timeUnit').value;

  const ratePerPeriod = unit==='week' ? annualRate/52 : annualRate/12;
  const periods = unit==='year' ? timeValue*12 : unit==='month' ? timeValue : timeValue;

  let balance = initial;
  const rows = [];

  // 第一行：初始
  rows.push({period:0, time:'起始', start:initial, invest:0, profit:0, end:initial});

  for(let i=1; i<=periods; i++){
    const start = balance;
    const profit = balance * ratePerPeriod;
    balance = start + profit + add;

    let timeLabel = '';
    if(unit==='year') timeLabel = i%12===0 ? `${i/12} 年末` : '';
    else if(unit==='month') timeLabel = i%12===0 ? `${i/12} 年末` : `第 ${i} 個月`;
    else timeLabel = i%52===0 ? `${i/52} 年末` : `第 ${i} 週`;

    if(timeLabel) {  // 只顯示整年或每月
      rows.push({
        period: i,
        time: timeLabel,
        start: Math.round(start),
        invest: add,
        profit: Math.round(profit),
        end: Math.round(balance)
      });
    }
  }

  // 顯示總結
  const final = Math.round(balance);
  $('result').innerHTML = `${timeValue} ${unitText()} 後，預計資產達到：<br><span id="finalNum">${fmt(final)}</span>`;

  // 填表
  const tbody = $('tbody');
  tbody.innerHTML = '';
  rows.forEach((r, idx) => {
    const tr = document.createElement('tr');
    if(idx===rows.length-1) tr.classList.add('highlight');
    tr.innerHTML = `
      <td>${r.period===0 ? '—' : r.period}</td>
      <td>${r.time}</td>
      <td>${fmt(r.start)}</td>
      <td>${fmt(r.invest)}</td>
      <td>${fmt(r.profit)}</td>
      <td>${fmt(r.end)}</td>
    `;
    tbody.appendChild(tr);
  });

  $('table').style.display = 'table';
}

// 初始化
load();
calc();

// 即時更新
document.querySelectorAll('input,select').forEach(el=>el.addEventListener('input',calc));
$('.calc-btn').onclick = calc;
$('#darkBtn').onclick = ()=>{document.body.classList.toggle('dark');calc();};
</script>
</body>
</html>
