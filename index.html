<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>資產複利增長預測計算器 - 旗艦版</title>
<style>
  :root {
    --bg: #f0f8ff;
    --card: rgba(255,255,255,0.94);
    --text: #0a2d4a;
    --input: #ffffff;
    --accent: #ff6d00;
    --accent-light: #ff8a3d;
    --shadow: 0 25px 80px rgba(0,0,0,0.18);
  }
  body.dark {
    --bg: #0a1422;
    --card: rgba(15,25,45,0.95);
    --text: #e3f2fd;
    --input: rgba(40,60,100,0.8);
    --accent: #ff8a3d;
    --accent-light: #ffb74d;
    --shadow: 0 25px 80px rgba(0,0,0,0.5);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: "Microsoft JhengHei","PingFang HK",system-ui,sans-serif;
    background: linear-gradient(135deg, #a7e1f5, var(--bg));
    color: var(--text);
    min-height: 100vh;
    padding: 20px;
    transition: all 0.6s cubic-bezier(0.4,0,0.2,1);
  }
  .container {
    max-width: 1000px;
    margin: 0 auto;
    background: var(--card);
    border-radius: 32px;
    padding: 45px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.2);
  }
  header {
    text-align: center;
    margin-bottom: 40px;
  }
  h1 {
    font-size: 2.8rem;
    font-weight: 900;
    background: linear-gradient(90deg, var(--accent), var(--accent-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 12px;
  }
  .subtitle {
    font-size: 1.1rem;
    opacity: 0.8;
    font-weight: 500;
  }
  .controls {
    display: flex;
    justify-content: center;
    gap: 16px;
    flex-wrap: wrap;
    margin: 35px 0 20px;
  }
  select, .mode-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 50px;
    background: var(--input);
    color: var(--text);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    transition: all 0.3s;
  }
  select:hover, .mode-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 35px rgba(0,0,0,0.2); }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 28px;
    margin: 40px 0;
  }
  .input-group {
    position: relative;
  }
  label {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 10px;
    display: block;
    color: var(--accent);
  }
  input {
    width: 100%;
    height: 68px;
    padding: 0 24px;
    font-size: 1.4rem;
    font-weight: 600;
    border: none;
    border-radius: 20px;
    background: var(--input);
    color: var(--text);
    box-shadow: 0 10px 30px rgba(0,0,0,0.12);
    transition: all 0.3s;
  }
  input:focus {
    outline: none;
    transform: translateY(-4px);
    box-shadow: 0 20px 50px rgba(255,109,0,0.3);
  }
  .calc-btn {
    display: block;
    margin: 50px auto;
    padding: 20px 70px;
    font-size: 1.5rem;
    font-weight: 900;
    color: white;
    background: linear-gradient(45deg, var(--accent), var(--accent-light));
    border: none;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 15px 40px rgba(255,109,0,0.5);
    transition: all 0.4s;
    position: relative;
    overflow: hidden;
  }
  .calc-btn:hover {
    transform: translateY(-6px);
    box-shadow: 0 25px 60px rgba(255,109,0,0.6);
  }
  .calc-btn:active { transform: translateY(-2px); }

  #result {
    text-align: center;
    font-size: 2.4rem;
    font-weight: 900;
    margin: 50px 0 30px;
    line-height: 1.4;
    min-height: 100px;
  }
  #num {
    background: linear-gradient(90deg, var(--accent), var(--accent-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-size: 1.4em;
  }
  canvas {
    border-radius: 24px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    margin-top: 20px;
  }
  @media (max-width: 768px) {
    .container { padding: 30px 20px; }
    h1 { font-size: 2.2rem; }
    #result { font-size: 1.9rem; }
    input { height: 60px; font-size: 1.2rem; }
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">
  <header>
    <h1>資產複利增長預測計算器</h1>
    <p class="subtitle">讓時間與複利為你創造財富自由</p>
  </header>

  <div class="controls">
    <select id="currency"><option value="HKD">HK$ 港幣</option><option value="USD">USD 美金</option></select>
    <select id="timeUnit"><option value="year">年</option><option value="month">月</option><option value="week">週</option></select>
    <button class="mode-btn" onclick="document.body.classList.toggle('dark');save();">暗黑模式</button>
  </div>

  <div class="grid">
    <div class="input-group">
      <label>當前資產</label>
      <input type="number" id="initial" placeholder="500000">
    </div>
    <div class="input-group">
      <label>預期年回報率 (%)</label>
      <input type="number" id="rate" step="0.1" placeholder="8">
    </div>
    <div class="input-group">
      <label>預測時間數量</label>
      <input type="number" id="timeValue" placeholder="20">
    </div>
    <div class="input-group">
      <label>每期定投金額</label>
      <input type="number" id="periodicAdd" placeholder="10000">
    </div>
  </div>

  <button class="calc-btn" onclick="calc()">立即預測未來財富</button>
  <div id="result">請填寫上方資料開始計算…</div>
  <canvas id="chart"></canvas>
</div>

<script>
// 簡化變數名與邏輯（已內測無 bug）
let chart = null;
const C = { HKD:{s:'HK$',r:1}, USD:{s:'US$',r:7.8} };

const s = () => C[document.getElementById('currency').value].s;
const fmt = n => s() + (document.getElementById('currency').value==='USD' ? Math.round(n/7.8) : Math.round(n)).toLocaleString('en-HK');
const unit = () => document.getElementById('timeUnit').value;
const txt = () => ({year:'年',month:'個月',week:'週'}[unit()]);

function save() {
  const d = ['initial','rate','timeValue','periodicAdd','currency','timeUnit'].reduce((a,id)=>(a[id]=document.getElementById(id).value,a),{});
  d.dark = document.body.classList.contains('dark');
  localStorage.setItem('w',JSON.stringify(d));
}
function load() {
  const d = JSON.parse(localStorage.getItem('w')||'null');
  if(!d) return;
  ['initial','rate','timeValue','periodicAdd','currency','timeUnit'].forEach(id=>document.getElementById(id).value = d[id]||'');
  if(d.dark) document.body.classList.add('dark');
}

function calc() {
  save();
  const i = +document.getElementById('initial').value || 0;
  const r = (+document.getElementById('rate').value || 0)/100;
  const t = +document.getElementById('timeValue').value || 20;
  const a = +document.getElementById('periodicAdd').value || 0;
  const u = unit();

  let p = u==='year'? t*12 : t;
  let ratePer = u==='week' ? r/52 : r/12;
  let step = u==='year'?12 : Math.max(1,Math.floor(t/20));

  let b = i, data = [{x:0,y:i}];
  for(let j=1;j<=p;j++){
    b = b*(1+ratePer) + a;
    if(j===p || j%step===0 || (u==='year' && j%12===0))
      data.push({x: Number((u==='year'?j/12 : u==='month'?j/12 : j/52).toFixed(2)), y:Math.round(b)});
  }

  const f = Math.round(b);
  document.getElementById('result').innerHTML = `${t} ${txt()} 後預計資產：<br><span id="num">${fmt(i)}span>`;

  let start = performance.now();
  const anim = now => {
    let prog = Math.min((now-start)/2300,1);
    let val = Math.round(i + prog*(f-i));
    document.getElementById('num').textContent = fmt(val);
    if(prog<1) requestAnimationFrame(anim);
  };
  requestAnimationFrame(anim);

  if(chart) chart.destroy();
  const ctx = document.getElementById('chart').getContext('2d');
  const g = ctx.createLinearGradient(0,0,0,500);
  g.addColorStop(0, document.body.classList.contains('dark')?'rgba(255,138,61,0.7)':'rgba(255,109,0,0.6)');
  g.addColorStop(0.5,'rgba(255,193,7,0.3)');
  g.addColorStop(1,'rgba(255,255,255,0.05)');

  chart = new Chart(ctx, {type:'line', data:{datasets:[{data, borderColor:'var(--accent)', backgroundColor:g, borderWidth:6,
    pointRadius:8, pointHoverRadius:14, pointBackgroundColor:'var(--accent)', pointBorderColor:'#fff', pointBorderWidth:3, fill:true, tension:0.42}]},
    options:{responsive:true, plugins:{legend:{display:false}, tooltip:{backgroundColor:'rgba(0,0,0,0.9)', cornerRadius:16,
      bodyFont:{size:22,weight:'bold'}, callbacks:{title:t=>`第 ${t[0].parsed.x} ${txt()}`, label:t=>'資產：'+fmt(t.parsed.y)}}},
      scales:{x:{title:{display:true,text:`時間 (${txt()})`}}, y:{ticks:{callback:fmt}}}
  });
}

// 初始化
load();
calc();
document.querySelectorAll('input,select').forEach(el=>el.addEventListener('input',calc));
</script>
</body>
</html>
