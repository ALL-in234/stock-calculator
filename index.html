<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>資產複利增長預測計算器 - 零 Bug 旗艦版</title>
<style>
  :root{--bg:#f0f8ff;--card:rgba(255,255,255,0.94);--text:#0a2d4a;--input:#ffffff;--accent:#ff6d00;--accent-l:#ff8a3d;--shadow:0 25px 80px rgba(0,0,0,0.18);}
  body.dark{--bg:#0a1422;--card:rgba(15,25,45,0.95);--text:#e3f2fd;--input:rgba(40,60,100,0.8);--accent:#ff8a3d;--accent-l:#ffb74d;--shadow:0 25px 80px rgba(0,0,0,0.5);}
  *{margin:0;padding:0;box-sizing:border-box;}
  body{font-family:"Microsoft JhengHei","PingFang HK",system-ui,sans-serif;background:linear-gradient(135deg,#a7e1f5,var(--bg));color:var(--text);min-height:100vh;padding:20px;transition:all .6s cubic-bezier(.4,0,.2,1);}
  .container{max-width:1000px;margin:0 auto;background:var(--card);border-radius:32px;padding:45px;box-shadow:var(--shadow);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.2);}
  header{text-align:center;margin-bottom:40px;}
  h1{font-size:2.8rem;font-weight:900;background:linear-gradient(90deg,var(--accent),var(--accent-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:12px;}
  .subtitle{font-size:1.1rem;opacity:.8;font-weight:500;}
  .controls{display:flex;justify-content:center;gap:16px;flex-wrap:wrap;margin:35px 0 20px;}
  select,.mode-btn{padding:12px 24px;border:none;border-radius:50px;background:var(--input);color:var(--text);font-size:16px;font-weight:600;cursor:pointer;backdrop-filter:blur(10px);box-shadow:0 8px 25px rgba(0,0,0,.1);transition:all .3s;}
  select:hover,.mode-btn:hover{transform:translateY(-3px);box-shadow:0 12px 35px rgba(0,0,0,.2);}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:28px;margin:40px 0;}
  label{font-weight:700 1.1rem/1 var(--accent);margin-bottom:10px;display:block;}
  input{width:100%;height:68px;padding:0 24px;font:600 1.4rem var(--text);border:none;border-radius:20px;background:var(--input);box-shadow:0 10px 30px rgba(0,0,0,.12);transition:all .3s;}
  input:focus{outline:none;transform:translateY(-4px);box-shadow:0 20px 50px rgba(255,109,0,.3);}
  .calc-btn{display:block;margin:50px auto;padding:20px 70px;font:900 1.5rem/1 #fff;background:linear-gradient(45deg,var(--accent),var(--accent-l));border:none;border-radius:50px;cursor:pointer;box-shadow:0 15px 40px rgba(255,109,0,.5);transition:all .4s;position:relative;overflow:hidden;}
  .calc-btn:hover{transform:translateY(-6px);box-shadow:0 25px 60px rgba(255,109,0,.6);}
  #result{text-align:center;font:900 2.4rem/1.4 var(--text);margin:50px 0 30px;min-height:100px;}
  #num{background:linear-gradient(90deg,var(--accent),var(--accent-l));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:1.4em;}
  canvas{border-radius:24px;box-shadow:0 20px 50px rgba(0,0,0,.2);margin-top:20px;}
  @media(max-width:768px){h1{font-size:2.2rem;}#result{font-size:1.9rem;}input{height:60px;font-size:1.2rem;}}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">
  <header>
    <h1>資產複利增長預測計算器</h1>
    <p class="subtitle">讓時間與複利為你創造財富自由</p>
  </header>

  <div class="controls">
    <select id="currency"><option value="HKD">HK$ 港幣</option><option value="USD">USD 美金</option></select>
    <select id="timeUnit"><option value="year">年</option><option value="month">月</option><option value="week">週</option></select>
    <button class="mode-btn" id="darkBtn">暗黑模式</button>
  </div>

  <div class="grid">
    <div><label>當前資產</label><input type="number" id="initial" min="0" step="1" value="500000"></div>
    <div><label>預期年回報率 (%)</label><input type="number" id="rate" min="-50" max="100" step="0.1" value="8"></div>
    <div><label>預測時間數量</label><input type="number" id="timeValue" min="0" value="20"></div>
    <div><label>每期定投金額</label><input type="number" id="periodicAdd" min="0" value="10000"></div>
  </div>

  <button class="calc-btn">立即預測未來財富</button>
  <div id="result">請填寫上方資料開始計算…</div>
  <canvas id="chart"></canvas>
div>

<script>
let chart=null;
const C={HKD:{s:'HK$',r:1},USD:{s:'US$',r:7.8}};

const els = {
  initial: document.getElementById('initial'),
  rate: document.getElementById('rate'),
  timeValue: document.getElementById('timeValue'),
  periodicAdd: document.getElementById('periodicAdd'),
  currency: document.getElementById('currency'),
  timeUnit: document.getElementById('timeUnit')
};

function fmt(n){
  const cur=els.currency.value;
  const val = cur==='USD' ? Math.round(n/7.8) : Math.round(n);
  return C[cur].s + val.toLocaleString('en-HK');
}
function unitText(){return {year:'年',month:'個月',week:'週'}[els.timeUnit.value];}

function save(){
  localStorage.setItem('w',JSON.stringify({
    initial:els.initial.value, rate:els.rate.value, timeValue:els.timeValue.value,
    periodicAdd:els.periodicAdd.value, currency:els.currency.value, timeUnit:els.timeUnit.value,
    dark:document.body.classList.contains('dark')
  }));
}
function load(){
  const d=JSON.parse(localStorage.getItem('w')||'null');
  if(!d) return;
  Object.keys(els).forEach(k=>els[k].value = d[k]??els[k].value);
  if(d.dark) document.body.classList.add('dark');
}

function calc(){
  save();

  let i = +els.initial.value||0;
  let r = (+els.rate.value||0)/100;
  let t = Math.max(0, +els.timeValue.value||0);
  let a = +els.periodicAdd.value||0;
  const u = els.timeUnit.value;

  if(t===0){
    document.getElementById('result').innerHTML = `目前資產：<br><span id="num">${fmt(i)}span>`;
    if(chart){chart.destroy();chart=null;}
    return;
  }

  const isYear = u==='year';
  const isWeek = u==='week';
  const periods = isYear ? t*12 : t;
  const ratePerPeriod = isWeek ? r/52 : r/12;
  const step = isYear ? 12 : Math.max(1, Math.floor(t/20));

  let balance = i;
  const data = [{x:0, y:i}];

  for(let j=1; j<=periods; j++){
    balance = balance * (1 + ratePerPeriod) + a;
    if(j===periods || j%step===0 || (isYear && j%12===0)){
      const xVal = isYear ? j/12 : isWeek ? j/52 : j/12;
      data.push({x: +xVal.toFixed( (isYear||isWeek)?1:2 ), y:Math.round(balance)});
    }
  }

  const final = Math.round(balance);
  document.getElementById('result').innerHTML = `${t} ${unitText()} 後預計資產：<br><span id="num">${fmt(i)}span>`;

  let start = performance.now();
  const anim = now => {
    const prog = Math.min((now-start)/2300,1);
    val = Math.round(i + prog*(final-i));
    document.getElementById('num').textContent = fmt(val);
    if(prog<1) requestAnimationFrame(anim);
  };
  requestAnimationFrame(anim);

  if(chart) chart.destroy();
  const ctx=document.getElementById('chart').getContext('2d');
  const g=ctx.createLinearGradient(0,0,0,500);
  g.addColorStop(0, document.body.classList.contains('dark')?'rgba(255,138,61,0.7)':'rgba(255,109,0,0.6)');
  g.addColorStop(0.5,'rgba(255,193,7,0.3)');
  g.addColorStop(1,'rgba(255,255,255,0.05)');

  chart = new Chart(ctx,{
    type:'line',data:{datasets:[{data,borderColor:'var(--accent)',backgroundColor:g,borderWidth:6,
      pointRadius:8,pointHoverRadius:14,pointBackgroundColor:'var(--accent)',pointBorderColor:'#fff',pointBorderWidth:3,fill:true,tension:0.42}]},
    options:{responsive:true,plugins:{legend:{display:false},tooltip:{backgroundColor:'rgba(0,0,0,0.9)',cornerRadius:16,bodyFont:{size:22,weight:'bold'},
      callbacks:{title:t=>`第 ${t[0].parsed.x} ${unitText()}`,label:t=>'資產：'+fmt(t.parsed.y)}}},
      scales:{x:{title:{display:true,text:`時間 (${unitText()})`}},y:{ticks:{callback:fmt}}}}
  });
}

// 初始化
load();
calc();

// 所有變動都即時更新
document.querySelectorAll('input,select').forEach(el=>el.addEventListener('input',calc));
document.querySelector('.calc-btn').addEventListener('click',calc);
document.getElementById('darkBtn').addEventListener('click',()=>{document.body.classList.toggle('dark');calc();});
</script>
</body>
</html>
